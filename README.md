# 資產管理系統 V6.9.0

## 系統概述
這是一個基於 React + TypeScript 的資產管理系統，提供會員管理、會費管理、投資管理、發票管理等功能。

## 主要功能

### 1. 會員管理
- 會員資料管理
- 會員類型設定
- 會員狀態追蹤

### 2. 會費管理
- 會費設定管理
- 會費收取記錄
- 會費歷史查詢
- 會費匯出功能
- **發票/收據管理** ✨ 新增

### 3. 投資管理
- 投資項目管理
- 租金管理
- 利潤分配
- 投資歷史記錄

### 4. 公司管理
- 公司資料管理
- 公司類型分類

### 5. 會計管理 ✨ 完整實現
- **會計科目管理**: 支援科目樹狀結構、科目類型分類
- **交易類別管理**: 收入、費用、資產、負債、權益分類
- **日記帳管理**: 完整的借貸分錄記錄、科目餘額查詢
- **應收帳款管理**: 客戶應收帳款、付款記錄、逾期追蹤
- **應付帳款管理**: 供應商應付帳款、付款記錄、逾期追蹤
- **月結管理**: 月度結帳、借貸平衡檢查、結帳記錄
- **財務報表**: 
  - 損益表（收入費用分析）
  - 資產負債表（資產負債權益）
  - 現金流量表（營業、投資、籌資活動）
  - 科目餘額表（試算表）
- **統計分析**: 各類統計資料和報表匯出

### 6. 會員服務
- 年度活動管理
- 活動報名管理
- 會員關懷記錄
- **風險管理** ✨ 完整實現
  - 會員逾期繳款記錄
  - 客戶租金逾期繳款記錄
  - **其他異常記錄** ✨ 新增
    - 異常記錄管理（新增、編輯、刪除）
    - 修改歷史追蹤
    - 狀態變更記錄

## 技術架構

### 前端
- **React 18** + **TypeScript**
- **Material-UI (MUI)** 組件庫
- **React Router** 路由管理
- **Axios** HTTP 客戶端
- **Notistack** 通知管理

### 後端
- **Node.js** + **Express**
- **PostgreSQL** 資料庫
- **Sequelize** ORM
- **JWT** 身份驗證
- **Render** 雲端部署

## 部署資訊

### 前端部署
- **URL**: https://asset-mgmt-v2.onrender.com
- **平台**: Render
- **分支**: main

### 後端 API
- **URL**: https://asset-mgmt-api-clean.onrender.com/api
- **平台**: Render
- **分支**: main

### 資料庫
- **類型**: PostgreSQL
- **平台**: Render
- **連線**: 雲端 PostgreSQL 服務

## 最新更新 (V6.9.0)

### 賬務管理功能完整實現 ✨
- **完整的會計系統**: 從模擬資料改為真實資料庫，支援完整的會計作業流程
- **會計科目管理**: 支援科目樹狀結構、科目類型分類（資產、負債、權益、收入、費用）
- **交易類別管理**: 收入、費用、資產、負債、權益分類，便於報表分析
- **日記帳管理**: 完整的借貸分錄記錄、科目餘額查詢、分頁和篩選功能
- **應收帳款管理**: 客戶應收帳款、付款記錄、逾期追蹤、統計分析
- **應付帳款管理**: 供應商應付帳款、付款記錄、逾期追蹤、統計分析
- **月結管理**: 月度結帳、借貸平衡檢查、結帳記錄、年度月結查詢
- **財務報表系統**: 
  - 損益表（收入費用分析）
  - 資產負債表（資產負債權益）
  - 現金流量表（營業、投資、籌資活動）
  - 科目餘額表（試算表）
- **資料庫結構**: 建立 6 個主要資料表和相關索引
- **API 路由**: 完整的 RESTful API 設計，支援所有 CRUD 操作
- **預設資料**: 自動初始化 20 個會計科目和 16 個交易類別

### 異常記錄編輯和修改歷史功能 ✨
- **異常記錄編輯功能**: 新增完整的編輯對話框，支援修改所有欄位內容
- **修改歷史追蹤**: 建立 `anomaly_changes` 資料表，自動記錄每次修改的詳細資訊
- **狀態管理優化**: 特別針對處理狀態的變更，支援待處理、處理中、已解決、已關閉
- **修改原因記錄**: 每次修改都會要求填寫修改原因，便於追蹤處理過程
- **歷史記錄查看**: 新增歷史記錄對話框，以表格形式顯示完整的修改歷史

### 主要新增功能
- **編輯對話框組件**: `EditAnomalyDialog` - 完整的表單編輯介面
- **歷史記錄組件**: `AnomalyHistoryDialog` - 表格形式顯示修改歷史
- **操作按鈕**: 每行異常記錄都有編輯和歷史按鈕
- **API 路由擴展**: 
  - `PUT /api/anomalies/:id` - 更新異常記錄（含修改歷史記錄）
  - `GET /api/anomalies/:id/changes` - 獲取修改歷史記錄
- **資料庫結構**: 
  - `anomalies` 表 - 主要異常記錄
  - `anomaly_changes` 表 - 修改歷史記錄（外鍵關聯）

### 技術改進
- **自動資料表建立**: 系統啟動時自動檢查並建立 `anomaly_changes` 資料表
- **修改記錄自動化**: 每次更新異常記錄時自動記錄修改歷史
- **前端狀態管理**: 編輯完成後自動重新載入資料
- **錯誤處理**: 完善的錯誤處理和使用者提示機制
- **使用者體驗**: 直觀的操作介面和狀態反饋

## 版本歷史

### V6.9.0 (2025-01-27) ✨ 最新版本
- **賬務管理功能完整實現**: 從模擬資料改為真實資料庫，支援完整的會計作業流程
- **會計科目管理**: 支援科目樹狀結構、科目類型分類（資產、負債、權益、收入、費用）
- **交易類別管理**: 收入、費用、資產、負債、權益分類，便於報表分析
- **日記帳管理**: 完整的借貸分錄記錄、科目餘額查詢、分頁和篩選功能
- **應收帳款管理**: 客戶應收帳款、付款記錄、逾期追蹤、統計分析
- **應付帳款管理**: 供應商應付帳款、付款記錄、逾期追蹤、統計分析
- **月結管理**: 月度結帳、借貸平衡檢查、結帳記錄、年度月結查詢
- **財務報表系統**: 損益表、資產負債表、現金流量表、科目餘額表
- **資料庫結構**: 建立 6 個主要資料表和相關索引
- **API 路由**: 完整的 RESTful API 設計，支援所有 CRUD 操作
- **預設資料**: 自動初始化 20 個會計科目和 16 個交易類別

### V6.8.0 (2025-01-27)
- **異常記錄編輯功能**: 新增完整的編輯對話框，支援修改所有欄位內容
- **修改歷史追蹤**: 建立 `anomaly_changes` 資料表，自動記錄每次修改的詳細資訊
- **狀態管理優化**: 支援待處理、處理中、已解決、已關閉四種狀態
- **修改原因記錄**: 每次修改都會要求填寫修改原因，便於追蹤處理過程
- **歷史記錄查看**: 新增歷史記錄對話框，以表格形式顯示完整的修改歷史
- **操作按鈕**: 每行異常記錄都有編輯和歷史按鈕
- **API 路由擴展**: 新增更新和歷史記錄查詢 API
- **資料庫結構**: 新增 `anomaly_changes` 表追蹤修改歷史
- **自動資料表建立**: 系統啟動時自動檢查並建立所需資料表

### V6.7.5 (2025-01-27)
- 修正收款狀況頁面逾期記錄顯示問題：移除 API 查詢中的狀態篩選條件
- 讓收款狀況頁面能顯示所有狀態的記錄（包含逾期）
- 解決歷史記錄頁面有逾期記錄但收款狀況頁面篩選逾期時為空的問題

### V6.7.4 (2025-01-27)
- 修正收款狀況頁面篩選邏輯，確保逾期記錄能正確顯示
- 新增日期格式化函數，修正風險管理頁面的日期顯示格式
- 會員逾期繳款記錄和客戶租金逾期記錄的日期現在顯示為 YYYY/MM/DD 格式
- 優化篩選功能，預設顯示全部記錄

### V6.7.3 (2025-01-27)
- 修正風險管理功能中的會員逾期繳款記錄查詢問題
- 修正狀態值不匹配問題：從 'overdue' 改為 '逾期'
- 在會費管理收款狀況頁面新增狀態篩選和會員類型篩選功能
- 確保逾期記錄能在收款狀況頁面正確顯示

### V6.7.2 (2025-01-27)
- 會員服務功能完整實現
- 年度活動管理、會員關懷記錄從模擬資料改為真實資料庫
- 修正租金收款管理逾期狀態設定問題

### V6.7.1 (2025-01-27)
- 修正統計報表計算錯誤（字串轉數字問題）
- 新增「當年度」篩選和欄位排序功能
- 修正會員名稱顯示問題

### V6.6.0 (2025-01-26)
- 會員分潤功能完整實現
- 從模擬資料改為真實資料庫連接
- 修正分潤金額計算和會員名稱顯示

### V6.5.0 (2025-01-25)
- 租金收款管理功能實現
- 支援租金項目生成、狀態管理
- 修正 ENUM 類型不匹配問題

### V6.4.0 (2025-01-24)
- 會費管理功能完整實現
- 支援會費標準設定、收款狀況追蹤
- 修正資料庫結構和 API 整合

### V6.3.0 (2025-01-23)
- 投資管理功能實現
- 支援投資項目 CRUD 操作
- 修正資料庫遷移和部署問題

### V6.2.0 (2025-01-22)
- 公司管理功能實現
- 支援公司資料 CRUD 操作
- 修正認證和權限問題

### V6.1.0 (2025-01-21)
- 會員管理功能實現
- 支援會員資料 CRUD 操作
- 修正資料庫連接問題

### V6.0.0 (2025-01-20)
- 初始版本發布
- 基本架構建立
- 部署到 Render 平台

## 安裝與部署

### 本地開發
```bash
# 安裝依賴
npm install

# 啟動開發服務器
npm run dev

# 建置生產版本
npm run build
```

### 雲端部署
1. 推送程式碼到 GitHub
2. Render 自動部署
3. 檢查部署狀態和日誌

## 資料庫結構

### 主要資料表
- `users` - 會員資料
- `companies` - 公司資料
- `investments` - 投資項目
- `fees` - 會費記錄
- `rental_payments` - 租金收款記錄
- `member_profits` - 會員分潤記錄
- `annual_activities` - 年度活動
- `activity_registrations` - 活動報名
- `member_cares` - 會員關懷記錄
- `anomalies` - 異常記錄
- `anomaly_changes` - 異常記錄修改歷史

## 聯絡資訊
- 開發者: Asset Management Team
- 版本: V6.9.0
- 更新日期: 2025-01-27


