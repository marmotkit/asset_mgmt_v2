# 資產管理系統 V6.7

## 系統概述
這是一個基於 React + TypeScript 的資產管理系統，提供會員管理、會費管理、投資管理、發票管理等功能。

## 主要功能

### 1. 會員管理
- 會員資料管理
- 會員類型設定
- 會員狀態追蹤

### 2. 會費管理
- 會費設定管理
- 會費收取記錄
- 會費歷史查詢
- 會費匯出功能
- **發票/收據管理** ✨ 新增

### 3. 投資管理
- 投資項目管理
- 租金管理
- 利潤分配
- 投資歷史記錄

### 4. 公司管理
- 公司資料管理
- 公司類型分類

### 5. 會計管理
- 應收帳款管理
- 應付帳款管理
- 財務報表
- 月結管理

### 6. 會員服務
- 年度活動管理
- 活動報名管理
- 會員關懷記錄
- 風險管理

## 技術架構

### 前端
- **React 18** + **TypeScript**
- **Material-UI (MUI)** 組件庫
- **React Router** 路由管理
- **Axios** HTTP 客戶端
- **Notistack** 通知管理

### 後端
- **Node.js** + **Express**
- **PostgreSQL** 資料庫
- **Sequelize** ORM
- **JWT** 身份驗證
- **Render** 雲端部署

## 部署資訊

### 前端部署
- **URL**: https://asset-mgmt-v2.onrender.com
- **平台**: Render
- **分支**: main

### 後端 API
- **URL**: https://asset-mgmt-api-clean.onrender.com/api
- **平台**: Render
- **分支**: main

### 資料庫
- **類型**: PostgreSQL
- **平台**: Render
- **連線**: 雲端 PostgreSQL 服務

## 最新更新 (V6.7)

### 會員分潤管理系統完整功能與路由衝突修復 ✨
- **會員分潤管理系統**: 完整的會員分潤 CRUD 功能，支援基於租賃標準和分潤標準的自動生成
- **當年度篩選功能**: 新增「當年度」勾選框，可查看整年的分潤項目，比照租金收款管理設計
- **欄位排序功能**: 所有表格欄位支援點擊排序，預設年月由小而大排序
- **路由衝突修復**: 修復 `/clear-all` 與 `/:id` 路由衝突問題，確保清除功能正常運作
- **會員名稱顯示修復**: 修正會員名稱顯示為「未知會員」的問題，改為調用真實 API 獲取會員資料

### 主要新增功能
1. **會員分潤管理系統**:
   - 完整的會員分潤 CRUD 操作
   - 基於租賃標準和分潤標準的自動生成
   - 年度/月度篩選功能
   - 分潤狀態管理（待發放、已發放、逾期）
   - 分潤金額計算（固定金額或百分比）

2. **當年度篩選與排序功能**:
   - 新增「當年度」勾選框，可查看整年的分潤項目
   - 當勾選「當年度」時，月份選擇器會被禁用
   - 所有表格欄位支援點擊排序（投資項目、會員、年月、金額、狀態等）
   - 預設按「年月」欄位升序排序（由小而大）
   - 當年度模式自動調整為年月升序排序

3. **路由衝突修復**:
   - 修復 `/clear-all` 與 `/:id` 路由衝突問題
   - 重新排列路由順序，將具體路徑放在參數路由之前
   - 確保清除會員分潤功能正常運作

4. **會員資料顯示修復**:
   - 修正會員名稱顯示為「未知會員」的問題
   - 將 `getMembers()` 方法改為調用真實 API 而非模擬資料
   - 確保會員分潤列表正確顯示會員名稱

5. **投資項目智能篩選**:
   - 只顯示有租賃標準的投資項目
   - 只顯示有分潤標準的投資項目
   - 避免重複生成分潤項目
   - 完整的投資項目選擇介面

### 技術改進
- 完整的 PostgreSQL 資料庫整合
- 原生 SQL 查詢優化
- 路由順序優化，避免路徑衝突
- 前端組件效能優化
- 完整的錯誤處理機制
- API 資料來源統一化

## 歷史更新

### V6.6.3 - 投資管理完整資料庫遷移 ✨
- **租賃標準管理系統**: 完整的租賃標準 CRUD 功能，支援投資項目的租賃條件設定
- **分潤標準管理系統**: 完整的分潤標準 CRUD 功能，支援投資項目的利潤分配規則
- **租金收款管理系統**: 完整的租金收款管理，支援年度/月度篩選、自動生成收款項目
- **智能排序功能**: 租金收款表格支援所有欄位排序，預設以年月排序，當年度模式自動調整排序方向

### 主要新增功能
1. **租賃標準管理**:
   - 投資項目租賃條件設定
   - 承租人資訊管理
   - 租賃期間設定
   - 租金金額管理
   - 完整的 CRUD 操作

2. **分潤標準管理**:
   - 投資項目利潤分配規則
   - 分潤比例設定
   - 分潤期間管理
   - 與租賃標準關聯
   - 完整的 CRUD 操作

3. **租金收款管理**:
   - 年度/月度篩選功能
   - 當年度模式（查看整年收款項目）
   - 自動生成收款項目
   - 收款狀態管理（待收款、已收款、逾期）
   - 收款方式記錄
   - 承租人/繳款人資訊管理
   - 完整的表格排序功能

4. **智能排序系統**:
   - 支援所有欄位排序（投資項目、年月、金額、狀態等）
   - 預設以年月降序排列（最近的在最上面）
   - 當年度模式自動調整為升序排列（從年初到年末）
   - 可點擊表格標頭切換排序方向

### 技術改進
- 完整的 PostgreSQL 資料庫整合
- 原生 SQL 查詢優化
- 前端組件效能優化
- 完整的錯誤處理機制
- 響應式設計改善

## 歷史更新

### V6.6.2 - 分潤標準管理系統
- **完整分潤標準功能**: 建立分潤標準 CRUD 管理系統
- **投資項目關聯**: 分潤標準與投資項目關聯，只顯示有租賃標準的項目
- **資料庫整合**: 將分潤標準從 localStorage 改為連接 PostgreSQL 資料庫
- **前端優化**: 改善分潤標準管理介面和使用者體驗

### V6.6.1 - 租賃標準管理系統
- **完整租賃標準功能**: 建立租賃標準 CRUD 管理系統
- **投資項目關聯**: 租賃標準與投資項目關聯管理
- **資料庫整合**: 將租賃標準從 localStorage 改為連接 PostgreSQL 資料庫
- **前端優化**: 改善租賃標準管理介面和使用者體驗

### V6.5 - 投資管理資料庫連結修正

### 投資管理資料庫連結修正 ✨
- **資料庫儲存系統**: 將投資管理從 localStorage 改為使用 PostgreSQL 資料庫
- **標準 SQL 查詢**: 後端使用原生 SQL 查詢，提升效能和穩定性
- **關聯資料顯示**: 投資列表顯示公司名稱和會員名稱
- **自動資料遷移**: 系統啟動時自動遷移現有投資資料

### 主要新增功能
1. **投資管理 API 重構**:
   - 完整的 CRUD 操作 API
   - 標準 SQL 查詢優化
   - 關聯資料查詢（公司、會員）
   - 完整的錯誤處理

2. **前端組件優化**:
   - 移除 localStorage 依賴
   - 直接顯示公司名稱和會員名稱
   - 改善資料載入效能
   - 統一的錯誤處理

3. **資料庫遷移系統**:
   - 自動遷移現有投資資料
   - 保持資料完整性
   - 向後相容性支援

### 技術改進
- 資料庫查詢效能優化
- 前端組件簡化
- 完整的錯誤處理機制
- 自動化資料遷移

## 歷史更新

### V6.4 - 會員管理密碼查詢系統

### 會員管理密碼查詢系統 ✨
- **新增密碼查詢功能**: 管理員可查詢會員的明文密碼
- **資料庫遷移系統**: 自動新增 plainPassword 欄位並設定預設密碼
- **API 錯誤修正**: 修正用戶管理相關的 500 錯誤問題
- **向後相容性**: 支援有無 plainPassword 欄位的資料庫環境

### 主要新增功能
1. **密碼查詢系統**:
   - 新增查詢密碼按鈕（眼睛圖示）
   - 密碼查詢對話框
   - 明文密碼顯示功能
   - 載入狀態和錯誤處理

2. **資料庫遷移功能**:
   - 新增 `plainPassword` 欄位到 users 表
   - 自動為現有用戶設定預設密碼
   - 遷移 API 端點：`POST /api/users/migrate/plain-password`
   - 完整的遷移狀態回報

3. **API 穩定性改進**:
   - 修正用戶列表查詢 500 錯誤
   - 動態檢查資料庫欄位存在性
   - 改善錯誤處理和用戶體驗

### 技術改進
- 資料庫遷移自動化
- 向後相容的 API 設計
- 完整的錯誤處理機制
- 開發環境的密碼管理便利性

## 歷史更新

### V6.3 - 公司管理與會員連結系統
- **完整公司管理功能**: 建立完整的公司 CRUD 管理系統
- **會員公司關聯**: 實現會員與公司的關聯管理
- **修正會員管理**: 將會員管理從 localStorage 改為連接後端 API
- **新增重設密碼功能**: 管理員可重設會員密碼

### V6.2 - 會費報表日期格式修正
- 修正會費報表繳費日期格式為台灣地區格式 (YYYY/MM/DD)
- 同步修正發票列表日期格式
- 確保所有日期顯示一致性

### V6.1 - 發票管理系統修正
- **修正資料庫連結**: 將發票管理系統從 localStorage 改為連接雲端資料庫
- **新增 Documents API**: 建立完整的發票/收據 CRUD API 端點
- **修正會員選擇邏輯**: 正確顯示有已收款記錄的會員
- **改善資料一致性**: 確保發票資料與雲端資料庫同步

## 安裝與運行

### 環境需求
- Node.js 18+
- npm 或 yarn
- PostgreSQL 資料庫

### 本地開發
```bash
# 安裝依賴
npm install

# 啟動開發伺服器
npm start

# 建置生產版本
npm run build
```

### 環境變數設定
建立 `.env` 檔案：
```env
DATABASE_URL=your_postgresql_connection_string
JWT_SECRET=your_jwt_secret
PORT=3001
```

## API 文檔

### 認證
所有 API 請求需要包含 JWT token：
```
Authorization: Bearer <your-jwt-token>
```

### 主要端點
- `POST /api/auth/login` - 用戶登入
- `GET /api/users` - 獲取會員列表
- `GET /api/fees` - 獲取會費記錄
- `GET /api/documents` - 獲取發票/收據列表
- `POST /api/documents` - 創建發票/收據
- `GET /api/rental-standards` - 獲取租賃標準列表 ✨ 新增
- `POST /api/rental-standards` - 創建租賃標準 ✨ 新增
- `PUT /api/rental-standards/:id` - 更新租賃標準 ✨ 新增
- `DELETE /api/rental-standards/:id` - 刪除租賃標準 ✨ 新增
- `GET /api/profit-sharing-standards` - 獲取分潤標準列表 ✨ 新增
- `POST /api/profit-sharing-standards` - 創建分潤標準 ✨ 新增
- `PUT /api/profit-sharing-standards/:id` - 更新分潤標準 ✨ 新增
- `DELETE /api/profit-sharing-standards/:id` - 刪除分潤標準 ✨ 新增
- `GET /api/rental-payments` - 獲取租金收款列表 ✨ 新增
- `POST /api/rental-payments` - 創建租金收款項目 ✨ 新增
- `PUT /api/rental-payments/:id` - 更新租金收款項目 ✨ 新增
- `DELETE /api/rental-payments/:id` - 刪除租金收款項目 ✨ 新增
- `POST /api/rental-payments/generate` - 自動生成租金收款項目 ✨ 新增
- `DELETE /api/rental-payments/clear` - 清除租金收款項目 ✨ 新增

## 開發指南

### 程式碼結構
```
src/
├── components/          # React 組件
│   ├── common/         # 通用組件
│   ├── layout/         # 佈局組件
│   └── pages/          # 頁面組件
├── services/           # API 服務
├── types/              # TypeScript 類型定義
├── utils/              # 工具函數
└── routes/             # 路由配置
```

### 新增功能流程
1. 建立 TypeScript 類型定義
2. 實作 API 服務
3. 建立 React 組件
4. 加入路由配置
5. 測試功能

## 問題回報
如有問題或建議，請透過以下方式聯繫：
- 建立 GitHub Issue
- 發送 Pull Request

## 授權
本專案採用 MIT 授權條款。


