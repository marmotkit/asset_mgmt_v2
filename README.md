# 資產管理系統

## v5.8 版本更新（2025/01/24）

### 本次主要修正與新功能

- **收款狀況功能完整系統資料庫連接**
  - 修正後端查詢條件：將 `'pending'` 改為 `'待收款'` 以符合實際資料庫內容
  - 解決前端收款狀況頁面資料顯示問題
  - 確保年度應收費用資料能正確顯示在前端介面
  - 完整串接 PostgreSQL 資料庫，資料持久化存儲
  - 支援狀態篩選：待收款、已收款、逾期等狀態管理
  - 前端即時同步資料庫變更，無需重新整理頁面

### 技術修正
- 修正 `/api/fees` 路由查詢邏輯
- 確保前端 API 請求與後端資料庫內容一致
- 優化資料查詢效能與穩定性

---

## v5.7 版本更新（2025/07/13）

### 本次主要修正與新功能

- 會費標準設定全面串接 PostgreSQL 資料庫，資料集中管理
- 新增 `fee_settings` 資料表，支援排序欄位（order）
- 後端 API 完整支援 CRUD 與排序（單筆/批次）
- 前端「會費標準設定」頁面：
  - 支援拖曳排序（可直接拖曳表格列調整順序）
  - 支援上下箭頭排序（每列可點擊上下箭頭調整順序）
  - 支援「新增會費標準」功能，彈窗輸入資料
  - 編輯、排序、新增皆即時同步資料庫
- 產生年度應收、收款標準等功能全面對應 fee_settings 設定
- 完整修正 TypeScript 型別，部署流程穩定

---

# 資產管理系統 (Asset Management System)

## 專案簡介
這是一個現代化的資產管理系統，專門用於管理企業的動產和不動產投資。系統提供直觀的使用者介面，協助企業有效管理和追蹤各類資產。

## 主要功能
- 投資項目管理
  - 動產投資管理（設備、機械等）
  - 不動產投資管理（廠房、土地等）
  - 支援多公司和會員關聯
- 租賃與分潤管理
- 歷史記錄追蹤
- 發票管理
- 投資報表生成
- 會員服務與關懷管理
- 風險管理與異常追蹤
- 帳務管理
  - 日記帳、應收帳款、應付帳款
  - 月結功能
  - 財務報表

## 技術特點
- 前端框架：React + TypeScript
- UI 框架：Material-UI (MUI)
- 狀態管理：React Hooks
- 資料持久化：LocalStorage + RESTful API
- 開發工具：Vite

## 系統需求
- Node.js 16.x 或以上
- npm 7.x 或以上
- 現代瀏覽器支援（Chrome, Firefox, Safari, Edge）

## 安裝說明
1. 克隆專案
```bash
git clone [repository-url]
cd asset_mgmt
```

2. 安裝依賴
```bash
npm install
```

3. 啟動開發服務器
```bash
npm run dev
```

4. 建置生產版本
```bash
npm run build
```

## 更新日誌

### v5.6 (最新)
- 修復用戶創建 API 功能
  - 添加缺失的 POST `/api/users` 路由
  - 實現完整的用戶創建邏輯，包含輸入驗證、重複檢查、密碼加密
  - 修復 UserRole 和 UserStatus 類型錯誤
  - 修復 companyId 處理，將空字符串轉換為 null 避免 UUID 類型錯誤
  - 添加詳細的調試日誌，便於問題診斷
  - 確保會員編號自動生成功能正常運作
- 優化後端 API 穩定性
  - 改進錯誤處理機制
  - 增強資料驗證邏輯
  - 提升 API 響應可靠性

### v5.5
- 會員收費標準調整
  - 一般會員：30,000/年
  - 永久會員：300,000/5年
  - 商務會員：3,000,000/5年
  - 管理員：0/永久
- 產生年度收款功能優化
  - 5年期會員（永久會員、商務會員）產生年度應收時，自動分攤金額並一次性產生5年收款項目
  - 每年金額 = 總金額/5，備註標註「5年期分攤」
  - 修正會員類型對應收費標準名稱，確保選擇會員時自動帶出正確收費標準
- 收款列表支援欄位排序
  - 點擊表頭可依會員編號、姓名、會員類型、金額、到期日、狀態排序
  - 顯示排序箭頭提示目前排序狀態

### v5.4 (最新)
- 新增帳務管理模組
  - 日記帳功能
    * 收入與支出記錄管理
    * 多種收支類型分類
    * 支援備註與附件
    * 簡易搜尋與過濾
  - 應收帳款管理
    * 客戶應收款項追蹤
    * 付款期限設定與提醒
    * 部分付款記錄
    * 狀態追蹤（待收、部分已收、已收、逾期）
  - 應付帳款管理
    * 供應商應付款項追蹤
    * 付款日期與金額管理
    * 支援分期付款記錄
    * 狀態追蹤（待付、部分已付、已付、逾期）
  - 月結功能
    * 月度財務摘要
    * 收支餘額統計
    * 盈虧分析
    * 月結報表生成
  - 財務報表
    * 收支報表（按日/週/月/年）
    * 資產負債表
    * 現金流量表
    * 支援圖表視覺化展示
    * 報表匯出功能

### v5.3
- 新增會員服務風險管理功能
  - 會員逾期繳款記錄
    * 自動識別和標記逾期的會員分潤項目
    * 清晰顯示會員姓名、逾期年月和金額
    * 支援分頁和條目數量選擇
  - 客戶租金逾期繳款記錄
    * 自動識別和標記逾期的租金收款項目
    * 顯示承租人、逾期年月和金額
    * 詳細呈現租賃期間資訊
  - 其他異常記錄功能
    * 支援多種異常類型（繳款問題、合約爭議等）
    * 提供異常事件添加介面
    * 追蹤異常處理狀態和解決方案
  - 整合現有資料結構
    * 無需額外資料庫遷移
    * 兼容現有的會員和租金模型
    * 自動檢測和更新異常狀態

### v5.2
- 新增會員服務模塊
  - 年度活動管理功能
    * 支援活動資訊的增刪改查
    * 活動狀態管理（計劃中、報名中、進行中、已結束）
    * 支援報名狀態追蹤
  - 會員關懷功能
    * 支援多種關懷類型（生日祝福、節日問候、投資建議）
    * 關懷記錄管理
    * 關懷結果追蹤
  - 數據持久化
    * 使用 PostgreSQL 數據庫存儲
    * 透過 Render 平台的數據庫服務進行管理
    * 確保數據安全和一致性
- 修復部署問題
  - 解決 AnnualActivitiesTab.tsx 模組問題
  - 修復 xlsx 依賴問題
  - 添加 process-browser.js polyfill
  - 優化 webpack 配置
  - 添加自動修復腳本

### v3.5.11
- 修復會員分潤生成功能
  - 添加缺失的會員資料
  - 確保投資項目所屬會員能夠正確識別
  - 優化會員資料查詢邏輯
  - 改進錯誤處理機制

### v3.5.10
- 修復投資項目創建功能
  - 修正表單驗證邏輯，添加必填欄位檢查
  - 改進錯誤提示顯示
  - 修正 API 調用方式，確保正確創建投資項目
  - 優化使用者體驗

### v3.5.9
- 添加租金收款管理清除功能
  - 新增「清除租金項目」按鈕
  - 支援按年度和月份清除租金項目
  - 添加確認對話框防止誤操作
  - 優化使用者體驗

### v3.5.8
- 修復投資項目刪除功能
  - 添加刪除確認對話框
  - 完善刪除處理邏輯
  - 優化使用者體驗

### v3.5.7
- 修復會員分潤顯示問題
  - 修正會員名稱顯示錯誤
  - 優化分潤項目生成邏輯
  - 改進測試數據

### v3.5.6
- 改進租金收款和會員分潤功能
  - 優化表單欄位標籤和ID屬性
  - 改進表單自動填充功能
  - 提升無障礙訪問支持

### v3.5.1
- 完善租賃與分潤管理功能
  - 新增租賃標準設定
    * 支援按投資項目設定月租金
    * 支援設定生效日期和結束日期
    * 支援備註說明
  - 新增分潤標準設定
    * 支援多種分潤方式（百分比、固定金額等）
    * 支援設定分潤期間
    * 支援備註說明
  - 資料持久化存儲
    * 使用 localStorage 保存設定資料
    * 登出後資料不會消失
  - 新增組件
    * `RentalStandardTab`：租賃標準設定頁面
    * `ProfitSharingStandardTab`：分潤標準設定頁面

### v3.4.9
- 修正所有 TypeScript 錯誤
- 完成投資管理功能基礎建設

### v3.4.7
- 優化資料同步機制
- 修復所屬公司和會員選擇問題
- 改進本地資料持久化
- 移除冗餘的日誌輸出

## 授權
MIT License

## 貢獻指南
歡迎提交 Issue 和 Pull Request 來協助改進專案。

## 專案概述

這是一個基於 React + TypeScript 的資產管理系統，提供會員管理、會費管理、投資組合追蹤、資產配置等功能的網頁應用程式。

## 目前進度 (v3.4)

### 已完成功能

#### ✅ 專案基礎架構
* Webpack 配置
* React + TypeScript 環境建置
* Material-UI 整合
* 響應式設計

#### ✅ 主要導航框架
* 響應式側邊導航欄
* 主要內容區域配置
* 路由系統建置

#### ✅ 會員管理模組
* 會員登入系統
* 會員資料 CRUD
* 批次操作功能
* 資料匯入/匯出
* 會員等級管理
* 狀態管理

#### ✅ 會費管理模組 (v3.3 新增)
* 會費標準設定
  - 一般會員：3萬/年
  - 商務會員：30萬/年
  - 終身會員：300萬/5年
  - 支援費用標準調整
* 收款狀況管理
  - 會員繳費狀態追蹤（待收、已收、延遲、終止）
  - 會員搜尋功能
* 發票管理
  - 會員發票資訊管理
  - 發票資訊編輯
  - 發票列印功能

#### ✅ 使用者偏好設定
* 投資偏好管理
* 風險承受度設定
* 投資期限設定

#### ✅ 投資管理模組 (v3.3.2 新增)
* 投資總覽
* 動產投資管理
  - 新增/編輯動產投資
  - 動產資訊管理
  - 合約檔案管理
* 不動產投資管理
  - 新增/編輯不動產投資
  - 不動產資訊管理
  - 合約檔案管理
* 租金與收益管理
  - 租金收款記錄
  - 收款狀態追蹤
  - 分潤機制
    * 百分比分潤
    * 固定金額分潤
    * 自訂分潤方式
    * 最低/最高分潤金額設定

### 開發中功能

#### 🚧 會費管理模組擴充
* 催繳通知功能
  - 自動提醒機制
  - 通知方式設定
  - 通知紀錄追蹤
* 年費報表功能
  - 收款統計報表
  - 繳費狀況分析
  - 收入預測

#### 🚧 公司資訊模組
* 公司簡介
* 最新消息
* 投資標的介紹

#### 🚧 投資管理模組
* 投資總覽
* 動產投資管理
* 不動產投資管理
* 租金與收益管理

### 待開發功能

1. 會員服務模組
   * 入會申請
   * 投資諮詢預約
   * 專屬投資方案

2. 交易支付模組
   * 資金管理
   * 合約管理
   * 支付功能

3. 通知提醒模組
   * 投資回報提醒
   * 合約到期提醒
   * 市場動態推播

4. 安全隱私模組
   * 多層身份驗證
   * 資料加密存取
   * 隱私管理設定

## 技術堆疊

* 前端框架：React 18
* 開發語言：TypeScript 5
* UI 框架：Material-UI (MUI) v5
* 路由管理：React Router v6
* 建置工具：Webpack 5
* 版本控制：Git

## 本地開發

1. 安裝依賴：
```bash
npm install
```

2. 啟動開發服務器：
```bash
npm start
```

3. 訪問開發環境：
```
http://localhost:3000
```

### 預設管理員帳號
* 帳號：admin
* 密碼：admin6688

## 專案結構

```
src/
├── components/     # React 組件
│   ├── layout/    # 佈局組件
│   └── pages/     # 頁面組件
├── contexts/      # React Context
├── services/      # API 服務
├── types/         # TypeScript 類型定義
└── utils/         # 工具函數
```

## 版本歷史

### v3.4.1
- 新增會費報表功能
  - 儀表板顯示：年度總收、年度待收、各類別會員總收
  - 支援年度篩選功能（全部/個別年度）
  - 動態報表欄位選擇
  - Excel 報表匯出功能
  - 優化發票/收據狀態顯示

### v3.4
- 優化會費管理功能
- 擴充收款方式管理
- 支援篩選及管理收款方式
- 介面優化，統一輸入框大小
- 移除收據號碼欄位

### v3.3.5
* 會費管理功能優化
  - 歷史記錄管理功能強化
    * 新增編輯功能
    * 新增刪除功能
  - 匯出報表功能優化
    * 優化 CSV 匯出格式
    * 改善中文編碼支援
    * 精簡報表欄位

### v3.3.4
* 介面優化
  - 新增版權資訊顯示
  - 新增版本號顯示與控制功能
    * 支援滑鼠左鍵增加版本號
    * 支援滑鼠右鍵減少版本號
    * 自動處理版本號進位與退位

### v3.3.3
* 投資管理功能擴充
  - 新增累積租金顯示
  - 新增累積分潤計算與顯示
    * 支援百分比分潤自動計算
    * 支援固定金額分潤自動計算
    * 自動套用最低/最高分潤限制

### v3.3.2
* 新增投資管理功能模組
* 實作動產與不動產投資管理
* 新增租金收款記錄功能
* 添加分潤機制功能
  - 支援百分比分潤
  - 支援固定金額分潤
  - 支援自訂分潤方式
  - 支援最低/最高分潤金額設定

### v3.3
* 新增會費管理功能模組
* 實作會費標準設定
* 新增收款狀況管理
* 添加發票管理功能

### v3.0
* 完成會員管理功能
* 實現使用者認證系統
* 添加使用者偏好設定
* 優化使用者介面

### v2.0
* 重構專案架構
* 升級核心依賴
* 改善開發流程

### v1.0
* 初始化專案結構
* 設置基本開發環境

## 注意事項

* 建議在 Chrome 或 Firefox 最新版本中進行開發測試
* 開發時請遵循專案的程式碼規範
* TypeScript 嚴格模式已啟用
* 請確保 Node.js 版本 >= 16.0.0

## 貢獻指南

1. Fork 專案
2. 創建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交變更 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 發起合併請求

## 聯絡方式

* GitHub Issues: [提交問題](https://github.com/marmotkit/asset_mgmt_v2/issues)
* Email: [待定]

## 功能特點

### 基礎管理
- 會員管理
- 公司管理
- 投資項目管理
  - 動產投資
  - 不動產投資

### 租賃管理
- 租賃標準設定
  - 設定每個投資項目的租金金額
  - 可設定生效期間
  - 支援修改和刪除功能

- 租金收款管理
  - 依年度批次生成租金收款項目
  - 可選擇要生成的投資項目
  - 自動處理跨年度合約（如：2025/3/6-2026/3/5）
  - 支援編輯收款狀態、收款方式和日期
  - 可刪除錯誤的收款項目

### 分潤管理
- 分潤標準設定
  - 支援固定金額和百分比兩種分潤方式
  - 可設定最低和最高分潤金額
  - 可設定生效期間
  - 支援修改和刪除功能

- 會員分潤管理
  - 依年度批次生成會員分潤項目
  - 可選擇要生成的投資項目
  - 自動根據租金金額計算分潤金額
  - 支援編輯發放狀態、發放方式和日期
  - 可刪除錯誤的分潤項目

### 發票管理
- 多種發票類型：支援二聯式發票、三聯式發票和收據
- 批次列印：可批次列印發票和收據
- 發票狀態追蹤：追蹤發票的開立和列印狀態
- 自動帶入承租人資訊：開立發票時自動帶入承租人資訊

## 技術規格

### 前端
- React 18
- TypeScript
- Material-UI (MUI)
- React Router
- Notistack（通知提示）

### 開發工具
- Webpack
- ESLint
- Prettier

## 版本紀錄

### v3.5.4
- 改進投資歷史記錄功能
  - 新增年度統計儀表板
    * 顯示最近 5 年的統計資料
    * 每年度顯示：已收租金、已發放分潤、淨收入
    * 使用卡片式設計，清晰展示各年度數據
  - 優化歷史記錄列表
    * 新增年度篩選功能
    * 顯示已收租金和已發放分潤的詳細記錄
    * 依日期排序，方便查找
  - 改進資料載入機制
    * 自動載入最近 5 年的所有資料
    * 優化載入效能
    * 完善錯誤處理機制

### v3.5.3
- 修正統計報表功能
  - 修正租金收款金額計算錯誤
  - 修正投資項目租金統計錯誤
  - 改進金額格式化邏輯
  - 確保所有金額正確顯示

### v3.5.2
- 改進租金收款和會員分潤功能
  - 新增投資項目選擇功能
  - 優化跨年度租金收款生成邏輯
  - 改進錯誤處理和提示訊息
  - 移除多餘的確認對話框

### v3.5.1
- 完善租金收款和會員分潤功能
  - 修正重複生成問題
  - 優化錯誤處理機制
  - 改進使用者介面

### v3.5.0
- 新增租金收款和會員分潤功能
  - 實作租賃標準設定
  - 實作分潤標準設定
  - 新增收款和分潤項目生成功能

### v3.5.5 (2023-03-10)
- 新增發票管理功能：支援二聯式發票、三聯式發票和收據
- 改進發票列印功能：每種類型的發票都有對應的聯式（存根聯、收執聯、報帳聯）
- 優化發票水印顯示：確保每個聯式都有正確的水印
- 改進列印頁面佈局：確保列印時每個聯式都在新的一頁上

### v3.5.2 (2023-03-05)
- 改進租金收款和會員分潤功能
- 新增投資項目選擇功能
- 優化跨年度租金收款生成邏輯
- 改進錯誤處理和提示訊息

### v3.5.1 (2023-03-01)
- 修復會員管理頁面的錯誤
- 改進投資項目列表的排序和篩選功能
- 優化使用者介面的響應式設計

### v3.5.0 (2023-02-25)
- 新增會員分潤功能
- 新增租金收款管理功能
- 改進投資項目管理介面
- 新增資料匯出功能

## 版本 V6.0 更新

### 收款功能
- 已完成收款功能與雲端資料庫（Postgres）對接，所有收款資料皆儲存於雲端資料庫。
- 前端顯示、查詢、編輯、刪除等操作皆與雲端資料庫同步。

### 開發備註
- **後續如需修正雲端資料庫相關功能，請一律使用標準 SQL（node-postgres/pg 原生查詢），不要再使用 Sequelize。**
- 這樣可避免 ORM 相容性問題，確保資料查詢與操作一致。


