# 資產管理系統 V7.3.1

## 系統概述
這是一個基於 React + TypeScript 的資產管理系統，提供會員管理、會費管理、投資管理、發票管理、會計管理、投資看板等功能。

## 主要功能

### 1. 會員管理
- 會員資料管理
- 會員類型設定
- 會員狀態追蹤

### 2. 會費管理
- 會費設定管理
- 會費收取記錄
- 會費歷史查詢
- 會費匯出功能
- **發票/收據管理** ✨ 新增

### 3. 投資管理
- 投資項目管理
- 租金管理
- 利潤分配
- 投資歷史記錄

### 4. 公司管理
- 公司資料管理
- 公司類型分類

### 5. 會計管理 ✨ 完整實現
- **會計科目管理**: 支援科目樹狀結構、科目類型分類
- **交易類別管理**: 收入、費用、資產、負債、權益分類
- **日記帳管理**: 完整的借貸分錄記錄、科目餘額查詢
- **應收帳款管理**: 客戶應收帳款、付款記錄、逾期追蹤
- **應付帳款管理**: 供應商應付帳款、付款記錄、逾期追蹤
- **月結管理**: 月度結帳、借貸平衡檢查、結帳記錄
- **財務報表**: 
  - 損益表（收入費用分析）
  - 資產負債表（資產負債權益）
  - 現金流量表（營業、投資、籌資活動）
  - 科目餘額表（試算表）
- **統計分析**: 各類統計資料和報表匯出

### 6. 投資看板 ✨ 完整實現
- **投資標的管理**: 完整的投資標的 CRUD 操作
- **圖片上傳管理**: 支援多張圖片上傳、圖片壓縮、類型分類
- **前台展示**: 投資看板首頁、標的詳細頁面、搜尋篩選功能
- **洽詢管理**: 前台洽詢表單、後台洽詢管理、狀態追蹤
- **管理後台**: 投資標的狀態管理、批量操作、統計分析
- **響應式設計**: 支援桌面和行動裝置瀏覽
- **圖片優化**: 自動壓縮、格式轉換、大小限制

### 7. 會員服務
- 年度活動管理
- 活動報名管理
- 會員關懷記錄
- **風險管理** ✨ 完整實現
  - 會員逾期繳款記錄
  - 客戶租金逾期繳款記錄
  - **其他異常記錄** ✨ 新增
    - 異常記錄管理（新增、編輯、刪除）
    - 修改歷史追蹤
    - 狀態變更記錄

## 技術架構

### 前端
- **React 18** + **TypeScript**
- **Material-UI (MUI)** 組件庫
- **React Router** 路由管理
- **Axios** HTTP 客戶端
- **Notistack** 通知管理

### 後端
- **Node.js** + **Express**
- **PostgreSQL** 資料庫
- **Sequelize** ORM
- **JWT** 身份驗證
- **Render** 雲端部署

## 部署資訊

### 前端部署
- **URL**: https://asset-mgmt-v2.onrender.com
- **平台**: Render
- **分支**: main

### 後端 API
- **URL**: https://asset-mgmt-api-clean.onrender.com/api
- **平台**: Render
- **分支**: main

### 資料庫
- **類型**: PostgreSQL
- **平台**: Render
- **連線**: 雲端 PostgreSQL 服務

## 最新更新 (V7.3.1)

### 管理者年度活動報名管理功能 ✨
- **報名名單管理**: 管理者可查看所有活動的完整報名名單
- **統計資訊面板**: 
  - 總報名數、總人數統計
  - 男女人數分布
  - 各狀態分布（待確認、已確認、已出席、已取消、未出席）
- **批量狀態更新**: 支援多選報名記錄並批量更新狀態
- **匯出功能**: 一鍵匯出CSV格式的報名名單
- **管理介面**: 專用的管理對話框，包含統計、操作、名單表格
- **權限控制**: 僅管理者可見管理按鈕和功能
- **即時更新**: 狀態變更後自動重新載入統計資料

### 主要新增功能
- **管理按鈕**: 活動列表中新增「管理報名」按鈕（僅管理者可見）
- **統計面板**: 即時顯示報名統計資訊和狀態分布
- **批量操作**: 全選/取消全選、多選狀態更新
- **匯出功能**: CSV格式報名名單匯出，包含所有報名資訊
- **管理對話框**: 大型對話框設計，包含完整的管理功能

### 技術實現
- **前端組件**: 新增管理對話框、統計面板、批量操作介面
- **狀態管理**: 報名記錄選擇、批量更新狀態管理
- **資料處理**: 統計計算、CSV格式轉換、檔案下載
- **API整合**: 報名記錄查詢、狀態更新、統計計算
- **使用者體驗**: 即時反饋、載入狀態、錯誤處理

## 最新更新 (V7.1)

### 投資看板模組完整實現 ✨
- **完整的投資標的管理系統**: 從零開始建立完整的投資看板功能
- **投資標的 CRUD 操作**: 支援新增、編輯、刪除、查詢投資標的
- **圖片上傳管理**: 
  - 支援多張圖片上傳（主圖、相簿、文件）
  - 自動圖片壓縮（最大 800x600 像素，JPEG 品質 0.7）
  - 圖片大小限制（最大 5MB）
  - 格式支援（JPEG、PNG、WebP）
- **前台展示功能**:
  - 投資看板首頁（響應式設計）
  - 標的詳細頁面
  - 搜尋篩選功能（狀態、類型、金額範圍、地區、產業）
  - 分頁顯示和排序功能
- **洽詢管理系統**:
  - 前台洽詢表單（會員資訊、投資金額、留言）
  - 後台洽詢管理（狀態追蹤、回覆功能）
  - 洽詢狀態管理（待處理、處理中、已完成、已關閉）
- **管理後台功能**:
  - 投資標的狀態管理（預告、上市、隱藏、關閉）
  - 批量操作功能
  - 統計分析報表
  - 圖片管理介面
- **技術架構**:
  - 前端：React + TypeScript + Material-UI
  - 後端：Node.js + Express + PostgreSQL
  - 資料庫：4 個主要資料表（投資標的、圖片、洽詢、文件）
  - API：完整的 RESTful API 設計
- **圖片優化技術**:
  - Canvas API 圖片壓縮
  - Base64 編碼處理
  - 自動格式轉換
  - 大小限制檢查
- **資料庫結構**:
  - `investment_opportunities` - 投資標的主要資料
  - `investment_images` - 投資標的圖片資料
  - `investment_inquiries` - 洽詢記錄
  - `investment_documents` - 相關文件
- **API 路由**:
  - 投資標的管理：CRUD 操作、狀態管理、批量操作
  - 洽詢管理：新增洽詢、查詢洽詢、狀態更新
  - 圖片管理：圖片上傳、圖片查詢、圖片刪除

### 主要新增功能
- **投資看板首頁**: `InvestmentDashboard` - 響應式投資標的展示
- **投資標的詳細頁**: `InvestmentDetail` - 完整的標的資訊展示
- **洽詢對話框**: `InquiryDialog` - 前台洽詢表單
- **投資標的管理**: `InvestmentManagement` - 後台管理介面
- **投資標的表單**: `InvestmentForm` - 新增/編輯表單
- **圖片上傳組件**: `ImageUpload` - 拖拽上傳、圖片預覽、類型管理
- **洽詢管理頁面**: `InquiryManagement` - 後台洽詢管理
- **搜尋篩選組件**: 多條件篩選和排序功能

### 技術改進
- **圖片處理優化**: 自動壓縮、格式轉換、大小限制
- **響應式設計**: 支援桌面和行動裝置
- **狀態管理**: 完整的投資標的和洽詢狀態管理
- **錯誤處理**: 完善的錯誤處理和使用者提示
- **效能優化**: 圖片壓縮、分頁載入、快取機制
- **安全性**: 檔案類型檢查、大小限制、XSS 防護

## 版本歷史

### V7.3.1 (2025-01-27) ✨ 最新版本
- **管理者年度活動報名管理功能**: 完整的報名名單管理、統計、匯出功能
- **報名名單管理**: 管理者可查看所有活動的完整報名名單，支援多選和批量操作
- **統計資訊面板**: 即時顯示總報名數、總人數、男女人數分布、各狀態分布
- **批量狀態更新**: 支援多選報名記錄並批量更新狀態（待確認、已確認、已出席、已取消、未出席）
- **匯出功能**: 一鍵匯出CSV格式的報名名單，包含所有報名資訊
- **管理介面**: 專用的管理對話框，包含統計面板、操作按鈕、名單表格
- **權限控制**: 僅管理者可見管理按鈕和功能，確保資料安全
- **即時更新**: 狀態變更後自動重新載入統計資料，確保資料一致性
- **技術實現**: 前端組件擴展、狀態管理優化、API整合完善

### V7.2 (2025-01-27) ✨ 最新版本
- **會員服務管理模組功能擴展**: 新增租金付款狀況和資產分潤狀況功能
- **租金付款狀況**: 會員可查看個人租金付款狀況，支援年度/月份篩選
- **資產分潤狀況**: 會員可查看個人分潤狀況，支援年度/月份篩選
- **權限控制系統**: 一般會員只能查看自己資料，管理者可查看全部並編輯
- **資料來源整合**: 整合投資管理的租金收款和會員分潤資料
- **後端API權限控制**: 修改API路由添加用戶權限篩選
- **篩選和排序功能**: 多欄位排序、年度/月份篩選、當年度模式
- **狀態顯示**: 完整的付款和收款狀態顯示

### V7.1 (2025-01-27)
- 修正前端圖片顯示問題：在 API 回應時自動過濾舊的 via.placeholder.com URL
- 建立圖片 URL 清理腳本，自動替換不可用的圖片服務
- 優化圖片載入體驗，避免圖片載入錯誤

### V6.9.31 (2025-01-27)
- 修正投資標的圖片上傳問題：加入圖片壓縮功能，修正預設圖片 URL，增加請求大小限制
- 前端圖片壓縮：Canvas API 自動壓縮圖片（最大 800x600 像素，JPEG 品質 0.7）
- 後端處理：圖片長度檢查、預設圖片替換、10MB 請求大小限制
- 解決 HTTP 413 錯誤和資料庫欄位長度限制問題

### V6.9.0 (2025-01-27) ✨ 最新版本
- **賬務管理功能完整實現**: 從模擬資料改為真實資料庫，支援完整的會計作業流程
- **會計科目管理**: 支援科目樹狀結構、科目類型分類（資產、負債、權益、收入、費用）
- **交易類別管理**: 收入、費用、資產、負債、權益分類，便於報表分析
- **日記帳管理**: 完整的借貸分錄記錄、科目餘額查詢、分頁和篩選功能
- **應收帳款管理**: 客戶應收帳款、付款記錄、逾期追蹤、統計分析
- **應付帳款管理**: 供應商應付帳款、付款記錄、逾期追蹤、統計分析
- **月結管理**: 月度結帳、借貸平衡檢查、結帳記錄、年度月結查詢
- **財務報表系統**: 損益表、資產負債表、現金流量表、科目餘額表
- **資料庫結構**: 建立 6 個主要資料表和相關索引
- **API 路由**: 完整的 RESTful API 設計，支援所有 CRUD 操作
- **預設資料**: 自動初始化 20 個會計科目和 16 個交易類別

### V6.8.0 (2025-01-27)
- **異常記錄編輯功能**: 新增完整的編輯對話框，支援修改所有欄位內容
- **修改歷史追蹤**: 建立 `anomaly_changes` 資料表，自動記錄每次修改的詳細資訊
- **狀態管理優化**: 支援待處理、處理中、已解決、已關閉四種狀態
- **修改原因記錄**: 每次修改都會要求填寫修改原因，便於追蹤處理過程
- **歷史記錄查看**: 新增歷史記錄對話框，以表格形式顯示完整的修改歷史
- **操作按鈕**: 每行異常記錄都有編輯和歷史按鈕
- **API 路由擴展**: 新增更新和歷史記錄查詢 API
- **資料庫結構**: 新增 `anomaly_changes` 表追蹤修改歷史
- **自動資料表建立**: 系統啟動時自動檢查並建立所需資料表

### V6.7.5 (2025-01-27)
- 修正收款狀況頁面逾期記錄顯示問題：移除 API 查詢中的狀態篩選條件
- 讓收款狀況頁面能顯示所有狀態的記錄（包含逾期）
- 解決歷史記錄頁面有逾期記錄但收款狀況頁面篩選逾期時為空的問題

### V6.7.4 (2025-01-27)
- 修正收款狀況頁面篩選邏輯，確保逾期記錄能正確顯示
- 新增日期格式化函數，修正風險管理頁面的日期顯示格式
- 會員逾期繳款記錄和客戶租金逾期記錄的日期現在顯示為 YYYY/MM/DD 格式
- 優化篩選功能，預設顯示全部記錄

### V6.7.3 (2025-01-27)
- 修正風險管理功能中的會員逾期繳款記錄查詢問題
- 修正狀態值不匹配問題：從 'overdue' 改為 '逾期'
- 在會費管理收款狀況頁面新增狀態篩選和會員類型篩選功能
- 確保逾期記錄能在收款狀況頁面正確顯示

### V6.7.2 (2025-01-27)
- 會員服務功能完整實現
- 年度活動管理、會員關懷記錄從模擬資料改為真實資料庫
- 修正租金收款管理逾期狀態設定問題

### V6.7.1 (2025-01-27)
- 修正統計報表計算錯誤（字串轉數字問題）
- 新增「當年度」篩選和欄位排序功能
- 修正會員名稱顯示問題

### V6.6.0 (2025-01-26)
- 會員分潤功能完整實現
- 從模擬資料改為真實資料庫連接
- 修正分潤金額計算和會員名稱顯示

### V6.5.0 (2025-01-25)
- 租金收款管理功能實現
- 支援租金項目生成、狀態管理
- 修正 ENUM 類型不匹配問題

### V6.4.0 (2025-01-24)
- 會費管理功能完整實現
- 支援會費標準設定、收款狀況追蹤
- 修正資料庫結構和 API 整合

### V6.3.0 (2025-01-23)
- 投資管理功能實現
- 支援投資項目 CRUD 操作
- 修正資料庫遷移和部署問題

### V6.2.0 (2025-01-22)
- 公司管理功能實現
- 支援公司資料 CRUD 操作
- 修正認證和權限問題

### V6.1.0 (2025-01-21)
- 會員管理功能實現
- 支援會員資料 CRUD 操作
- 修正資料庫連接問題

### V6.0.0 (2025-01-20)
- 初始版本發布
- 基本架構建立
- 部署到 Render 平台

## 安裝與部署

### 本地開發
```bash
# 安裝依賴
npm install

# 啟動開發服務器
npm run dev

# 建置生產版本
npm run build
```

### 雲端部署
1. 推送程式碼到 GitHub
2. Render 自動部署
3. 檢查部署狀態和日誌

## 資料庫結構

### 主要資料表
- `users` - 會員資料
- `companies` - 公司資料
- `investments` - 投資項目
- `fees` - 會費記錄
- `rental_payments` - 租金收款記錄
- `member_profits` - 會員分潤記錄
- `annual_activities` - 年度活動
- `activity_registrations` - 活動報名
- `member_cares` - 會員關懷記錄
- `anomalies` - 異常記錄
- `anomaly_changes` - 異常記錄修改歷史

## 聯絡資訊
- 開發者: Asset Management Team
- 版本: V6.9.0
- 更新日期: 2025-01-27


